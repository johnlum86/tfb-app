<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TFB Bulk Order Command Centre v3.2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --primary: #007bff;
      --primary-dark: #0056b3;
      --accent: #ffb020;
      --bg: #f5f7fb;
      --bg-card: #ffffff;
      --bg-elevated: #ffffff;
      --text-main: #111827;
      --text-sub: #4b5563;
      --border-subtle: #d1d5db;
      --border-strong: #9ca3af;
      --chip-bg: #e5ebf5;
    }

    body.dark {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --accent: #fbbf24;
      --bg: #020617;
      --bg-card: #020617;
      --bg-elevated: #020617;
      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
      --border-subtle: #1f2933;
      --border-strong: #4b5563;
      --chip-bg: #111827;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 16px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      background: radial-gradient(circle at top, rgba(59,130,246,0.09), transparent 55%), var(--bg);
      color: var(--text-main);
      transition: background 0.25s ease, color 0.25s ease;
    }

    .wrapper {
      max-width: 880px;
      margin: 0 auto;
    }

    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    h1 {
      font-size: 1.3rem;
      margin: 0;
    }

    .subtitle {
      font-size: 0.8rem;
      color: var(--text-sub);
      margin-top: 2px;
    }

    .card {
      background: rgba(255,255,255,0.9);
      background: var(--bg-card);
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 16px 40px rgba(15,23,42,0.18);
      border: 1px solid var(--border-subtle);
    }

    body.dark .card {
      box-shadow: 0 18px 45px rgba(0,0,0,0.7);
    }

    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }

    .tab-btn {
      flex: 1;
      min-width: 120px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: var(--chip-bg);
      color: var(--text-sub);
      padding: 8px 10px;
      font-size: 0.8rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .tab-btn.active {
      background: var(--primary);
      border-color: var(--primary-dark);
      color: #ffffff;
      font-weight: 600;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    label {
      display: block;
      margin-top: 10px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    input, select, textarea {
      width: 100%;
      padding: 9px;
      margin-top: 4px;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      font-size: 0.9rem;
      background: var(--bg-elevated);
      color: var(--text-main);
    }

    textarea {
      resize: vertical;
      min-height: 70px;
    }

    input:focus, select:focus, textarea:focus {
      outline: 2px solid var(--primary);
      outline-offset: 1px;
      border-color: transparent;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .col-6 {
      flex: 1 1 calc(50% - 8px);
    }

    .col-4 {
      flex: 1 1 calc(33.33% - 8px);
    }

    .col-8 {
      flex: 1 1 calc(66.66% - 8px);
    }

    @media (max-width: 640px) {
      .col-6, .col-4, .col-8 {
        flex: 1 1 100%;
      }
    }

    .btn, button {
      border-radius: 999px;
      border: none;
      padding: 9px 12px;
      font-size: 0.85rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.18s ease;
      font-weight: 500;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: #ffffff;
      box-shadow: 0 8px 18px rgba(37,99,235,0.35);
      width: 100%;
      margin-top: 12px;
    }

    .btn-primary:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 4px 10px rgba(15,23,42,0.6);
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid var(--border-subtle);
      color: var(--text-main);
    }

    .btn-accent {
      background: linear-gradient(135deg, var(--accent), #f97316);
      color: #111827;
    }

    .btn-sm {
      padding: 7px 10px;
      font-size: 0.75rem;
    }

    .mt-8 { margin-top: 8px; }
    .mt-12 { margin-top: 12px; }
    .mt-16 { margin-top: 16px; }

    #output, #batchOutput {
      margin-top: 8px;
      padding: 10px;
      border-radius: 10px;
      border: 1px dashed var(--border-subtle);
      background: radial-gradient(circle at top left, rgba(59,130,246,0.05), transparent 55%), var(--bg-elevated);
      white-space: pre-wrap;
      font-size: 0.85rem;
      min-height: 40px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 0.8rem;
    }

    th, td {
      border: 1px solid var(--border-subtle);
      padding: 6px;
    }

    th {
      background: rgba(148,163,184,0.2);
      text-align: left;
    }

    #printCard {
      margin-top: 10px;
      padding: 10px;
      border-radius: 10px;
      border: 1px dashed var(--border-subtle);
      background: var(--bg-elevated);
      font-size: 0.85rem;
    }

    #qrImage {
      margin-top: 10px;
      max-width: 220px;
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 999px;
      background: var(--chip-bg);
      color: var(--text-sub);
      font-size: 0.75rem;
    }

    .spacer {
      flex: 1 1 auto;
    }

    .theme-toggle {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      padding: 6px 10px;
      background: var(--chip-bg);
      font-size: 0.75rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    @media print {
      body {
        background: #ffffff;
      }
      .no-print {
        display: none !important;
      }
      #printCard {
        box-shadow: none;
        border-style: solid;
      }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="header-row no-print">
      <div>
        <h1>TFB Bulk Order Command Centre v3.2</h1>
        <div class="subtitle">Single reminder ¬∑ Batch orders ¬∑ QR sheet ¬∑ Dark mode</div>
      </div>
      <div style="display:flex; flex-direction:column; align-items:flex-end; gap:6px;">
        <button id="themeToggle" class="theme-toggle" type="button">
          <span id="themeIcon">üåô</span>
          <span id="themeLabel">Dark</span>
        </button>
        <div class="pill">
          <span style="font-size:0.7rem;">TFB</span> OPS
        </div>
      </div>
    </div>

    <div class="card">
      <div class="tabs no-print">
        <button class="tab-btn active" data-tab="single">‚ö° Single Reminder</button>
        <button class="tab-btn" data-tab="batch">üì¶ Batch Mode</button>
        <button class="tab-btn" data-tab="qrpdf">üî≥ QR & PDF</button>
        <button class="tab-btn" data-tab="outlets">üè¨ Outlets</button>
      </div>

      <!-- SINGLE REMINDER -->
      <div id="tab-single" class="tab-content active">
        <div class="row">
          <div class="col-6">
            <label for="dateInput">Date</label>
            <input type="date" id="dateInput" />
          </div>
          <div class="col-6">
            <label for="eventInput">Event</label>
            <input type="text" id="eventInput" placeholder="e.g., Corporate Catering" />
          </div>
        </div>

        <div class="row">
          <div class="col-6">
            <label for="paxInput">Pax</label>
            <input type="number" id="paxInput" placeholder="e.g., 120" />
          </div>
          <div class="col-6">
            <label for="outletSelect">Outlet</label>
            <select id="outletSelect"></select>
          </div>
        </div>

        <label for="notesInput">Notes</label>
        <textarea
          id="notesInput"
          placeholder="Special instructions (sauce separate, extra salmon, etc.)"
        ></textarea>

        <button class="btn btn-primary" type="button" onclick="generateSingle()">
          üöÄ Generate Reminder
        </button>

        <h3 class="mt-16" style="font-size:0.95rem;">WhatsApp Message</h3>
        <div id="output">(Your message will appear here)</div>

        <div class="row mt-8 no-print">
          <div class="col-4">
            <button class="btn btn-accent btn-sm" type="button" onclick="copySingle()">
              üìã Copy Message
            </button>
          </div>
          <div class="col-4">
            <button class="btn btn-ghost btn-sm" type="button" onclick="openWhatsAppSingle()">
              üü¢ Open in WhatsApp
            </button>
          </div>
        </div>

        <h3 class="mt-16" style="font-size:0.95rem;">Add to Calendar</h3>
        <div class="row no-print">
          <div class="col-6">
            <button class="btn btn-ghost btn-sm" type="button" onclick="openIOSCalendar()">
              üì≤ iPhone Calendar (.ics)
            </button>
          </div>
          <div class="col-6">
            <a id="androidBtn" class="btn btn-ghost btn-sm" href="#" target="_blank">
              ü§ñ Android / Google Calendar
            </a>
          </div>
        </div>
      </div>

      <!-- BATCH MODE -->
      <div id="tab-batch" class="tab-content">
        <p style="font-size:0.8rem; color:var(--text-sub);">
          Use batch mode when you have the same event date across multiple outlets.
        </p>
        <div class="row">
          <div class="col-6">
            <label for="batchDate">Date</label>
            <input type="date" id="batchDate" />
          </div>
          <div class="col-6">
            <label for="batchEvent">Event</label>
            <input type="text" id="batchEvent" placeholder="e.g., Company Lunch" />
          </div>
        </div>

        <label>Outlet rows</label>
        <table>
          <thead>
            <tr>
              <th>Outlet</th>
              <th style="width:70px;">Pax</th>
              <th>Notes</th>
              <th style="width:50px;">Action</th>
            </tr>
          </thead>
          <tbody id="batchBody"></tbody>
        </table>
        <button class="btn btn-ghost btn-sm mt-8" type="button" onclick="addBatchRow()">
          ‚ûï Add Outlet Row
        </button>

        <button class="btn btn-primary mt-12" type="button" onclick="generateBatch()">
          üìÑ Generate Batch Text
        </button>

        <h3 class="mt-16" style="font-size:0.95rem;">Batch WhatsApp Text</h3>
        <div id="batchOutput">(Batch messages will appear here)</div>

        <button class="btn btn-accent btn-sm mt-8 no-print" type="button" onclick="copyBatch()">
          üìã Copy Batch
        </button>
      </div>

      <!-- QR & PDF -->
      <div id="tab-qrpdf" class="tab-content">
        <p style="font-size:0.8rem; color:var(--text-sub);">
          QR uses your <b>last generated single reminder</b>. Printing works offline.
        </p>
        <div id="printCard">
          <strong>Order Sheet Preview</strong>
          <div id="printDetails" style="margin-top:6px;">
            (Generate a single reminder first.)
          </div>
          <img id="qrImage" alt="QR code preview" />
        </div>

        <div class="row mt-12 no-print">
          <div class="col-6">
            <button class="btn btn-primary btn-sm" type="button" onclick="generateQR()">
              üî≥ Generate QR
            </button>
          </div>
          <div class="col-6">
            <button class="btn btn-ghost btn-sm" type="button" onclick="window.print()">
              üñ® Print / Save as PDF
            </button>
          </div>
        </div>
      </div>

      <!-- OUTLETS -->
      <div id="tab-outlets" class="tab-content">
        <p style="font-size:0.8rem; color:var(--text-sub);">
          Manage preset outlets here. Stored only on this device (localStorage).
        </p>
        <div class="row">
          <div class="col-8">
            <label for="newOutlet">Add New Outlet</label>
            <input type="text" id="newOutlet" placeholder="e.g., Setia City Mall" />
          </div>
          <div class="col-4" style="margin-top:22px;">
            <button class="btn btn-primary btn-sm" type="button" onclick="addOutletFromManager()">
              Add Outlet
            </button>
          </div>
        </div>

        <h3 class="mt-12" style="font-size:0.95rem;">Current Outlets</h3>
        <ul id="outletList" style="list-style:none; padding-left:0; font-size:0.85rem;"></ul>
      </div>
    </div>
  </div>

  <script>
    // -------- THEME (AUTO + TOGGLE) --------
    function applyTheme(mode) {
      const body = document.body;
      if (mode === "dark") {
        body.classList.add("dark");
        document.getElementById("themeIcon").textContent = "‚òÄÔ∏è";
        document.getElementById("themeLabel").textContent = "Light";
      } else {
        body.classList.remove("dark");
        document.getElementById("themeIcon").textContent = "üåô";
        document.getElementById("themeLabel").textContent = "Dark";
      }
    }

    function initTheme() {
      const saved = localStorage.getItem("tfbTheme");
      if (saved === "dark" || saved === "light") {
        applyTheme(saved);
      } else {
        const prefersDark = window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches;
        applyTheme(prefersDark ? "dark" : "light");
      }

      document.getElementById("themeToggle").addEventListener("click", () => {
        const isDark = document.body.classList.contains("dark");
        const next = isDark ? "light" : "dark";
        applyTheme(next);
        localStorage.setItem("tfbTheme", next);
      });
    }

    // -------- TABS --------
    function initTabs() {
      const buttons = document.querySelectorAll(".tab-btn");
      buttons.forEach((btn) => {
        btn.addEventListener("click", () => {
          buttons.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          const tabName = btn.getAttribute("data-tab");
          document.querySelectorAll(".tab-content").forEach((c) => {
            c.classList.remove("active");
          });
          document.getElementById("tab-" + tabName).classList.add("active");
        });
      });
    }

    // -------- OUTLETS STATE --------
    let outlets = [];
    let lastICSUrl = null;
    let 
lastMessage =
        "üö® BULK ORDER REMINDER üö®\n\n" +
        "üìÖ Date: " + dateVal + "\n" +
        "üéâ Event: " + eventVal + "\n" +
        "üë• Pax: " + (paxVal || "-") + "\n" +
        "üè™ Outlet: " + outletVal + "\n" +
        "üìù Notes: " + (notesVal || "-") + "\n\n" +
        "üìå Add to Calendar:\n" +
        "iPhone (ICS - temporary link):\n" + lastICSUrl + "\n\n" +
        "Android Calendar:\n" + googleLink + "\n\n" +
        "Please acknowledge once added. TQ team.";

      document.getElementById("output").textContent = lastMessage;
      document.getElementById("androidBtn").href = googleLink;

      lastMeta = {
        date: dateVal,
        event: eventVal,
        pax: paxVal,
        outlet: outletVal,
        notes: notesVal
      };
      localStorage.setItem("tfbLastMessage", lastMessage);
      localStorage.setItem("tfbLastMeta", JSON.stringify(lastMeta));
      updatePrintDetails(lastMeta, lastMessage);
    }

updatePrintDetails(lastMeta, lastMessage);
    }
    }

    function copySingle() {
      if (!lastMessage) {
        alert("Generate a reminder first");
        return;
      }
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(lastMessage)
          .then(() => alert("Message copied!"))
          .catch(() => alert("Clipboard blocked. Please copy manually."));
      } else {
        alert("Clipboard not supported. Copy manually.");
      }
    }

    function openWhatsAppSingle() {
      if (!lastMessage) {
        alert("Generate a reminder first");
        return;
      }
      const url = "https://wa.me/?text=" + encodeURIComponent(lastMessage);
      window.open(url, "_blank");
    }

    function openIOSCalendar() {
      if (!lastICSUrl) {
        alert("Generate a reminder first");
        return;
      }
      window.location.href = lastICSUrl;
    }

    // -------- BATCH MODE --------
    function addBatchRow() {
      const tbody = document.getElementById("batchBody");
      const tr = document.createElement("tr");

      const tdOutlet = document.createElement("td");
      const sel = document.createElement("select");
      sel.className = "batch-outlet";
      outlets.forEach((o) => {
        const opt = document.createElement("option");
        opt.value = o;
        opt.textContent = o;
        sel.appendChild(opt);
      });
      tdOutlet.appendChild(sel);

      const tdPax = document.createElement("td");
      const paxInput = document.createElement("input");
      paxInput.type = "number";
      paxInput.className = "batch-pax";
      paxInput.style.width = "70px";
      tdPax.appendChild(paxInput);

      const tdNotes = document.createElement("td");
      const notesInput = document.createElement("input");
      notesInput.type = "text";
      notesInput.className = "batch-notes";
      tdNotes.appendChild(notesInput);

      const tdAction = document.createElement("td");
      const btn = document.createElement("button");
      btn.textContent = "‚úï";
      btn.className = "btn btn-sm btn-ghost";
      btn.type = "button";
      btn.onclick = () => tr.remove();
      tdAction.appendChild(btn);

      tr.appendChild(tdOutlet);
      tr.appendChild(tdPax);
      tr.appendChild(tdNotes);
      tr.appendChild(tdAction);

      tbody.appendChild(tr);
    }

    function generateBatch() {
      const dateVal = (document.getElementById("batchDate").value || "").trim();
      const eventVal = (document.getElementById("batchEvent").value || "").trim();
      if (!dateVal) {
        alert("Select a Date for batch");
        document.getElementById("batchDate").focus();
        return;
      }
      if (!eventVal) {
        alert("Fill in Event for batch");
        document.getElementById("batchEvent").focus();
        return;
      }

      const rows = document.querySelectorAll("#batchBody tr");
      if (!rows.length) {
        alert("Add at least one outlet row");
        return;
      }

      let out = "";
      rows.forEach((tr, idx) => {
        const outlet = tr.querySelector(".batch-outlet").value;
        const pax = (tr.querySelector(".batch-pax").value || "").trim();
        const notes = (tr.querySelector(".batch-notes").value || "").trim();

        out +=
          "[" + (idx + 1) + "] " + outlet + "\n" +
          "üìÖ Date: " + dateVal + "\n" +
          "üéâ Event: " + eventVal + "\n" +
          "üë• Pax: " + (pax || "-") + "\n" +
          "üìù Notes: " + (notes || "-") + "\n\n";
      });

      document.getElementById("batchOutput").textContent = out;
    }

    function copyBatch() {
      const text = document.getElementById("batchOutput").textContent;
      if (!text || text.startsWith("(Batch")) {
        alert("Generate batch text first");
        return;
      }
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text)
          .then(() => alert("Batch text copied!"))
          .catch(() => alert("Clipboard blocked. Copy manually."));
      } else {
        alert("Clipboard not supported. Copy manually.");
      }
    }

    // -------- QR & PRINT --------
    function updatePrintDetails(meta, message) {
      if (!meta) return;
      const div = document.getElementById("printDetails");
      div.textContent =
        "Date: " + meta.date + "\n" +
        "Event: " + meta.event + "\n" +
        "Outlet: " + meta.outlet + "\n" +
        "Pax: " + (meta.pax || "-") + "\n" +
        "Notes: " + (meta.notes || "-") + "\n\n" +
        "Message:\n" + message;
    }

    function generateQR() {
      if (!lastMessage) {
        alert("Generate a single reminder first");
        return;
      }
      const url =
        "https://chart.googleapis.com/chart?cht=qr&chs=300x300&chl=" +
        encodeURIComponent(lastMessage);
      const img = document.getElementById("qrImage");
      img.src = url;
      img.alt = "QR for last reminder";
      if (lastMeta) updatePrintDetails(lastMeta, lastMessage);
    }

    // -------- INIT --------
    window.addEventListener("DOMContentLoaded", () => {
      initTheme();
      initTabs();
      loadOutlets();
      renderOutletSelects();

      // One default row for batch
      addBatchRow();

      // Restore last reminder (for QR/print)
      try {
        const metaStr = localStorage.getItem("tfbLastMeta");
        const msg = localStorage.getItem("tfbLastMessage");
        if (metaStr && msg) {
          lastMeta = JSON.parse(metaStr);
          
lastMessage =
        "üö® BULK ORDER REMINDER üö®\n\n" +
        "üìÖ Date: " + dateVal + "\n" +
        "üéâ Event: " + eventVal + "\n" +
        "üë• Pax: " + (paxVal || "-") + "\n" +
        "üè™ Outlet: " + outletVal + "\n" +
        "üìù Notes: " + (notesVal || "-") + "\n\n" +
        "üìå Add to Calendar:\n" +
        "iPhone (ICS - temporary link):\n" + lastICSUrl + "\n\n" +
        "Android Calendar:\n" + googleLink + "\n\n" +
        "Please acknowledge once added. TQ team.";

      document.getElementById("output").textContent = lastMessage;
      document.getElementById("androidBtn").href = googleLink;

      lastMeta = {
        date: dateVal,
        event: eventVal,
        pax: paxVal,
        outlet: outletVal,
        notes: notesVal
      };
      localStorage.setItem("tfbLastMessage", lastMessage);
      localStorage.setItem("tfbLastMeta", JSON.stringify(lastMeta));
      updatePrintDetails(lastMeta, lastMessage);
    }

updatePrintDetails(lastMeta, lastMessage);
        }
      } catch (e) {}
    });
  </script>
</body>
</html>
