<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TFB Bulk Order Command Centre v3.5 (Clean)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --primary: #007bff;
      --primary-dark: #0056b3;
      --accent: #ffb020;
      --bg: #f5f7fb;
      --bg-card: #ffffff;
      --text-main: #111827;
      --text-sub: #4b5563;
      --border-subtle: #d1d5db;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 16px;
      font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }
    .wrapper { max-width: 860px; margin: 0 auto; }
    h1 { margin: 0 0 6px 0; font-size: 1.3rem; }
    .subtitle { font-size: 0.8rem; color: var(--text-sub); margin-bottom: 10px; }
    .card {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 14px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 10px 24px rgba(15,23,42,0.12);
    }
    .tabs { display:flex; gap:6px; margin-bottom:10px; }
    .tab-btn {
      flex:1;
      padding:8px;
      border-radius:999px;
      border:1px solid var(--border-subtle);
      background:#e5ebf5;
      font-size:0.8rem;
    }
    .tab-btn.active { background:var(--primary); color:#fff; border-color:var(--primary-dark); }
    .tab-content { display:none; }
    .tab-content.active { display:block; }
    label {
      display:block;
      margin-top:10px;
      font-size:0.8rem;
      font-weight:600;
    }
    input,select,textarea {
      width:100%;
      padding:9px;
      margin-top:4px;
      border-radius:8px;
      border:1px solid var(--border-subtle);
      font-size:0.9rem;
    }
    textarea { min-height:70px; resize:vertical; }
    .row { display:flex; flex-wrap:wrap; gap:8px; }
    .col-6 { flex:1 1 calc(50% - 8px); }
    @media (max-width:640px){ .col-6{flex:1 1 100%;} }
    .btn {
      border-radius:999px;
      border:none;
      padding:9px 12px;
      font-size:0.85rem;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      cursor:pointer;
      font-weight:500;
    }
    .btn-primary {
      background:linear-gradient(135deg,var(--primary),var(--primary-dark));
      color:#fff;
      width:100%;
      margin-top:12px;
    }
    .btn-ghost {
      background:transparent;
      border:1px solid var(--border-subtle);
      color:var(--text-main);
    }
    .btn-accent {
      background:linear-gradient(135deg,var(--accent),#f97316);
      color:#111827;
    }
    .btn-sm { padding:7px 10px; font-size:0.75rem; }
    #output {
      margin-top:8px;
      padding:10px;
      border-radius:10px;
      border:1px dashed var(--border-subtle);
      background:#f9fafb;
      white-space:pre-wrap;
      font-size:0.85rem;
      min-height:40px;
    }
    ul { list-style:none; padding-left:0; font-size:0.85rem; }
    ul li { margin-bottom:4px; }
  </style>
</head>
<body>
  <div class="wrapper">
    <h1>TFB Bulk Order Command Centre v3.5</h1>
    <div class="subtitle">Clean build ¬∑ Single Reminder + Outlet Manager (Bandar Sunway preset)</div>

    <div class="card">
      <div class="tabs">
        <button class="tab-btn active" data-tab="single">‚ö° Single Reminder</button>
        <button class="tab-btn" data-tab="outlets">üè¨ Outlets</button>
      </div>

      <!-- SINGLE REMINDER TAB -->
      <div id="tab-single" class="tab-content active">
        <div class="row">
          <div class="col-6">
            <label for="dateInput">Date</label>
            <input type="date" id="dateInput">
          </div>
          <div class="col-6">
            <label for="eventInput">Event</label>
            <input type="text" id="eventInput" placeholder="e.g., Corporate Catering">
          </div>
        </div>

        <div class="row">
          <div class="col-6">
            <label for="paxInput">Pax</label>
            <input type="number" id="paxInput" placeholder="e.g., 120">
          </div>
          <div class="col-6">
            <label for="outletSelect">Outlet</label>
            <select id="outletSelect"></select>
          </div>
        </div>

        <label for="notesInput">Notes</label>
        <textarea id="notesInput" placeholder="Sauce separate, extra salmon, etc."></textarea>

        <button class="btn btn-primary" type="button" onclick="generateSingle()">
          üöÄ Generate WhatsApp Message
        </button>

        <h3 style="margin-top:14px; font-size:0.95rem;">WhatsApp Message</h3>
        <div id="output">(Generated message will appear here)</div>

        <div class="row" style="margin-top:8px;">
          <div class="col-6">
            <button class="btn btn-accent btn-sm" type="button" onclick="copySingle()">
              üìã Copy Message
            </button>
          </div>
          <div class="col-6">
            <button class="btn btn-ghost btn-sm" type="button" onclick="openWhatsAppSingle()">
              üü¢ Open in WhatsApp
            </button>
          </div>
        </div>

        <h3 style="margin-top:16px; font-size:0.95rem;">Add to Calendar</h3>
        <div class="row">
          <div class="col-6">
            <button class="btn btn-ghost btn-sm" type="button" onclick="openIOSCalendar()">
              üì≤ iPhone (.ics)
            </button>
          </div>
          <div class="col-6">
            <a id="androidBtn" class="btn btn-ghost btn-sm" href="#" target="_blank">
              ü§ñ Android / Google Calendar
            </a>
          </div>
        </div>
      </div>

      <!-- OUTLETS TAB -->
      <div id="tab-outlets" class="tab-content">
        <p style="font-size:0.8rem; color:#4b5563;">
          Manage preset outlets here. Stored only on this device.
        </p>
        <label for="newOutlet">Add New Outlet</label>
        <input type="text" id="newOutlet" placeholder="e.g., Mid Valley">
        <button class="btn btn-primary btn-sm" type="button" onclick="addOutletFromManager()" style="margin-top:8px; width:auto;">
          ‚ûï Add Outlet
        </button>

        <h3 style="margin-top:14px; font-size:0.95rem;">Current Outlets</h3>
        <ul id="outletList"></ul>
      </div>
    </div>
  </div>

  <script>
    // Basic tab handling
    document.querySelectorAll(".tab-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".tab-btn").forEach((b) =>
          b.classList.remove("active")
        );
        btn.classList.add("active");
        const tab = btn.getAttribute("data-tab");
        document.querySelectorAll(".tab-content").forEach((c) =>
          c.classList.remove("active")
        );
        document.getElementById("tab-" + tab).classList.add("active");
      });
    });

    // Outlets state
    let outlets = [];
    let lastICSUrl = null;
    let lastMessage = "";
    let lastMeta = null;

    const defaultOutlets = ["Bandar Sunway"];

    function loadOutlets() {
      try {
        const stored = localStorage.getItem("tfbOutletsSimple");
        if (stored) {
          outlets = JSON.parse(stored);
        } else {
          outlets = defaultOutlets.slice();
        }
      } catch (e) {
        outlets = defaultOutlets.slice();
      }
    }

    function saveOutlets() {
      localStorage.setItem("tfbOutletsSimple", JSON.stringify(outlets));
    }

    function renderOutletSelects() {
      const sel = document.getElementById("outletSelect");
      sel.innerHTML = "";
      outlets.forEach((o) => {
        const opt = document.createElement("option");
        opt.value = o;
        opt.textContent = o;
        sel.appendChild(opt);
      });

      const ul = document.getElementById("outletList");
      ul.innerHTML = "";
      outlets.forEach((o, idx) => {
        const li = document.createElement("li");
        li.textContent = o + " ";
        const btn = document.createElement("button");
        btn.textContent = "Remove";
        btn.className = "btn btn-sm btn-ghost";
        btn.type = "button";
        btn.style.marginLeft = "6px";
        btn.onclick = () => {
          if (confirm('Remove outlet "' + o + '" ?')) {
            outlets.splice(idx, 1);
            saveOutlets();
            renderOutletSelects();
          }
        };
        li.appendChild(btn);
        ul.appendChild(li);
      });
    }

    function addOutletFromManager() {
      const input = document.getElementById("newOutlet");
      const name = (input.value || "").trim();
      if (!name) {
        alert("Enter outlet name");
        return;
      }
      if (outlets.includes(name)) {
        alert("Outlet already exists");
        return;
      }
      outlets.push(name);
      saveOutlets();
      input.value = "";
      renderOutletSelects();
    }

    // Single reminder
    function generateSingle() {
      const dateEl = document.getElementById("dateInput");
      const eventEl = document.getElementById("eventInput");
      const paxEl = document.getElementById("paxInput");
      const outletEl = document.getElementById("outletSelect");
      const notesEl = document.getElementById("notesInput");

      const dateVal = (dateEl.value || "").trim();
      const eventVal = (eventEl.value || "").trim();
      const paxVal = (paxEl.value || "").trim();
      const outletVal = outletEl.value;
      const notesVal = (notesEl.value || "").trim();

      if (!dateVal) {
        alert("Please select a Date");
        dateEl.focus();
        return;
      }
      if (!eventVal) {
        alert("Please fill in Event");
        eventEl.focus();
        return;
      }

      // Ensure Safari keeps date value
      dateEl.setAttribute("value", dateVal);

      const d = new Date(dateVal);
      const y = d.getFullYear();
      const m = ("0" + (d.getMonth() + 1)).slice(-2);
      const day = ("0" + d.getDate()).slice(-2);

      const start = `${y}${m}${day}T090000`;
      const end = `${y}${m}${day}T100000`;

      const googleLink =
        "https://calendar.google.com/calendar/render?action=TEMPLATE" +
        "&text=" + encodeURIComponent(eventVal + " Bulk Order") +
        "&dates=" + start + "/" + end +
        "&details=" + encodeURIComponent(
          "Pax: " + paxVal + "\\nOutlet: " + outletVal + "\\nNotes: " + notesVal
        ) +
        "&location=" + encodeURIComponent(outletVal);

      const icsContent =
        "BEGIN:VCALENDAR\n" +
        "VERSION:2.0\n" +
        "BEGIN:VEVENT\n" +
        "SUMMARY:" + eventVal + " Bulk Order\n" +
        "DTSTART:" + start + "\n" +
        "DTEND:" + end + "\n" +
        "DESCRIPTION:Pax: " + paxVal + "\\nOutlet: " + outletVal + "\\nNotes: " + notesVal + "\n" +
        "LOCATION:" + outletVal + "\n" +
        "END:VEVENT\n" +
        "END:VCALENDAR";

      if (lastICSUrl) URL.revokeObjectURL(lastICSUrl);
      const blob = new Blob([icsContent], { type: "text/calendar" });
      lastICSUrl = URL.createObjectURL(blob);

      lastMessage =
        "üö® BULK ORDER REMINDER üö®\n\n" +
        "üìÖ Date: " + dateVal + "\n" +
        "üéâ Event: " + eventVal + "\n" +
        "üë• Pax: " + (paxVal || "-") + "\n" +
        "üè™ Outlet: " + outletVal + "\n" +
        "üìù Notes: " + (notesVal || "-") + "\n\n" +
        "üìå Add to Calendar:\n" +
        "iPhone: Open the TFB app and tap the .ics button\n" +
        "Android:\n" + googleLink + "\n\n" +
        "Please acknowledge once added. TQ team.";

      document.getElementById("output").textContent = lastMessage;
      document.getElementById("androidBtn").href = googleLink;

      lastMeta = { date: dateVal, event: eventVal, pax: paxVal, outlet: outletVal, notes: notesVal };
    }

    function copySingle() {
      if (!lastMessage) {
        alert("Generate a reminder first");
        return;
      }
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(lastMessage)
          .then(() => alert("Message copied!"))
          .catch(() => alert("Clipboard blocked. Copy manually."));
      } else {
        alert("Clipboard not supported. Copy manually.");
      }
    }

    function openWhatsAppSingle() {
      if (!lastMessage) {
        alert("Generate a reminder first");
        return;
      }
      const url = "whatsapp://send?text=" + encodeURIComponent(lastMessage);
      window.location.href = url;
    }

    function openIOSCalendar() {
      if (!lastICSUrl) {
        alert("Generate a reminder first");
        return;
      }
      window.location.href = lastICSUrl;
    }

    // Init
    window.addEventListener("DOMContentLoaded", () => {
      loadOutlets();
      renderOutletSelects();
    });
  </script>
</body>
</html>
